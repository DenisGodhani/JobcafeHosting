{% extends 'base.html' %}
{% block header_wrapper %}
{% with authenticate=False %}
{{ block.super }}
{% endwith%}
{% endblock header_wrapper%}
{% block content %}
{% load static %}
<section class="pt-120 pb-120 mt-120">
  <div class="container">
    <div class="row">
      <div class="col-lg-6 col-md-5">
        <img src="{% static 'img/login.svg' %}" alt="">
      </div>
      <div class="col-lg-6 col-md-7">
        <div class="login-form">
          <div class="top-info text-center mb-40">
            <h2>USER LOGIN</h2>
            <p>Welcome back</p>
          </div>
          <!-- Form Input Field Start -->
          <form action="" method="POST" id="login-forgot-new-form">
            {% csrf_token %}
            <div class="alert alert-danger" role="alert" style="display: none;">
              password and confirm password should be matched!
            </div>
            <div class="input-field">
              <span class="icon">
                <svg viewBox="0 0 26.998 36.808">
                  <g id="Group_13027" data-name="Group 13027" transform="translate(0 0)">
                    <path id="Path_10929" data-name="Path 10929"
                      d="M99.726,316H76.152a1.649,1.649,0,0,0-1.712,1.578v20.444a1.649,1.649,0,0,0,1.712,1.578H99.726a1.65,1.65,0,0,0,1.712-1.578v-20.59A1.666,1.666,0,0,0,99.726,316ZM89.572,327.525v5.983H86.625v-6.129a2.747,2.747,0,0,1-1.5-3.18,3.138,3.138,0,0,1,5.941,0,2.747,2.747,0,0,1-1.5,3.18Z"
                      transform="translate(-74.44 -302.792)" fill="#ced0da" />
                    <path id="Path_10930" data-name="Path 10930"
                      d="M81.336,329.28a7.654,7.654,0,0,1-3.6-6.386c0-4.4,3.927-7.965,8.772-7.965s8.772,3.566,8.772,7.965a7.654,7.654,0,0,1-3.6,6.386h3.84A9.747,9.747,0,0,0,94.3,315.171a12.349,12.349,0,0,0-15.587,0A9.747,9.747,0,0,0,77.5,329.28Z"
                      transform="translate(-72.865 -312.401)" fill="#ced0da" />
                  </g>
                </svg>
              </span>
              <a class="info-icon" href="javascript:void(0)" data-toggle="modal" data-target="#pass-info-popup">i</a>
              <input class="form-input" type="password" placeholder="New Password" name="NewPassword" id="NewPassword">
            </div>
            <div class="input-field">
              <span class="icon">
                <svg viewBox="0 0 25.465 35.827">
                  <path id="Path_10929" data-name="Path 10929"
                    d="M98.29,316H76.055a1.556,1.556,0,0,0-1.615,1.489v19.283a1.556,1.556,0,0,0,1.615,1.488H98.29a1.556,1.556,0,0,0,1.615-1.489V317.35A1.571,1.571,0,0,0,98.29,316Zm-9.578,10.871v5.643H85.933v-5.781a2.591,2.591,0,0,1-1.412-3,2.96,2.96,0,0,1,5.6,0,2.591,2.591,0,0,1-1.412,3Z"
                    transform="translate(-74.44 -302.434)" fill="#ced0da" />
                  <path id="Icon"
                    d="M1180.233,147.261a8.359,8.359,0,0,1-.3-2.241c0-4.254,3.1-7.7,6.925-7.708a6.339,6.339,0,0,1,6.431,4.093,1.815,1.815,0,0,0,2.538.967,2.223,2.223,0,0,0,.869-2.824,10.039,10.039,0,0,0-9.839-6.458,10.4,10.4,0,0,0-8.55,4.727,13.012,13.012,0,0,0-1.774,10.434Z"
                    transform="translate(-1174.008 -133.09)" fill="#ced0da" /></svg>
              </span>
              <input class="form-input" type="password" placeholder="Confirm New Password" name="CNewPassword">
            </div>
            <div class="text-center mt-50">
              <button type="submit" class="btn btn-log btn-icon">
                <span class="icon">
                  <span class="single-icon">
                    <svg viewBox="0 0 36.91 30.888">
                      <defs>
                        <linearGradient id="linear-gradient" x1="0.5" x2="0.5" y2="1" gradientUnits="objectBoundingBox">
                          <stop offset="0" stop-color="#5574f7" />
                          <stop offset="1" stop-color="#60c3ff" />
                        </linearGradient>
                      </defs>
                      <g id="Group_13032" data-name="Group 13032" transform="translate(36.91) rotate(90)">
                        <path id="Path_29560" data-name="Path 29560"
                          d="M9.033,30.888H0L13.4,15.439,0,0H9.042l13.39,15.439Z"
                          transform="translate(0 22.432) rotate(-90)" fill="url(#linear-gradient)" />
                        <path id="Path_29561" data-name="Path 29561"
                          d="M9.042,30.888H0L13.4,15.439,0,0H9.051l13.39,15.439Z"
                          transform="translate(0 36.91) rotate(-90)" fill="url(#linear-gradient)" />
                      </g>
                    </svg>
                  </span>
                </span>
                Submit
              </button>
            </div>
          </form>
          <!-- Form Input Field End -->
          <!-- Password Popup Start Start -->
          <div class="modal pass-popup-info fade" id="pass-info-popup" tabindex="-1" role="dialog"
            aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"><a href="#">close</a></span>
                  </button>
                </div>
                <div class="modal-body">
                  <div class="thumb">
                    <img src="{% static 'img/pass-thumb.svg' %}" alt="">
                  </div>
                  <div class="password-info">
                    <p>Password must be 8 or more characters, not contain any spaces,
                      and
                      must
                      following below character sets;</p>
                    <ul class="check-list passchecker">
                      <li><span class="checkbox"></span>Uppercase alphabetic
                        characters
                        A-Z
                      </li>
                      <li><span class="checkbox"></span>Lowercase alphabetic
                        characters
                        A-Z
                      </li>
                      <li><span class="checkbox"></span>Numeric characters 0-9</li>
                      <li><span class="checkbox"></span>Special characters #?!@$%&*-
                      </li>
                    </ul>
                  </div>

                </div>
              </div>
            </div>
          </div>
          <!-- Password Popup Start End -->
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block javascripts %}
<script>
  $(document).ready(function () {
    var flag = 1;
    $('#NewPassword').bind('input', function () {
      var password = $(this).val();
      var passcheckerlist = $('.passchecker li');
      var truesign = "<span class='check-icon'><svg viewBox='0 0 13.629 9.4'><path id='Checkbox' d='M5.4,9.4,0,3.995,1.1,2.9,5.4,7.128,12.533,0l1.1,1.1Z' fill='#fff'/></svg></span>";
      var regex = [/[A-Z]/, /[a-z]/, /[0-9]/, /[#?!@$%&*-]/]
      if (password) {
        for (var i = 0; i < passcheckerlist.length; i++) {
          if (password.match(regex[i])) {
            flag = 0;
            if (!$(passcheckerlist[i]).hasClass('active')) {
              $(passcheckerlist[i]).addClass('active').children().append(truesign)
            }
          }
          else {
            flag = 1;
            if ($(passcheckerlist[i]).hasClass('active')) {
              $(passcheckerlist[i]).removeClass('active').children().children().remove()
            }
          }
        }
      }
      else {
        flag = 1;
        for (var i = 0; i < passcheckerlist.length; i++) {
          if ($(passcheckerlist[i]).hasClass('active')) {
            $(passcheckerlist[i]).removeClass('active').children().children().remove()
          }
        }
      }
    });

    $("#login-forgot-new-form").submit(function (e) {
      e.preventDefault();
      if (flag) {
        $('#pass-info-popup').modal('show');
      }
      else {
        var serializedData = $(this).serialize();
        $.ajax({
          type: 'POST',
          url: "{% url 'save_new_password' %}",
          data: serializedData,
          success: function (response) {
            if (response.isValid) {
              location.href = "{% url 'LoginNewPassSucess' %}"
            }
            else {
              $('.alert-danger').show();
            }
          },
          error: function (response) {
            console.log(response);
            console.log("Error! something went wrong");
          }
        });
      }
    });
  });
</script>
{% endblock %}